<div id="right">  
  <div id="participants">
    <h3 style="border-bottom:1px solid #fff;"><%= image_tag "group.png" %>
      
       <%= link_to_remote ("Participants / Score <span id='participant-count'>(#{get_joined_participants_count(@post) })</span>" + image_tag("bullet_arrow_down.png")), :url => { :action => :load_all_participants, :uid => @user.unique_id, :pid => @post.unique_id }, :update => 'list-all-p' %>
            </h3>
  
   <div id="list-all-p">
     <% viewed_count = 0 %>
   <ul id="participants-list">
    <% unless @post.spectators.empty? %>
        <% @post.spectators.find_all_by_match_id(@match.id, :order => 'totalscore desc').each do |spectator| %>
              <% engagement = Engagement.find_by_id(spectator.engagement_id) %>
              <div id="participant_details_<%=engagement.invitee.id %>" >

              <% if engagement.invitee.id == @user.id  %>
                  <li id='you'><%= image_tag "user_red.png" %> Me (Score <%= spectator.totalscore %>)
              <% else %>
                    <% if engagement.invitee.member? %>
                      <li><%= image_tag "user_green.png" %> <%=  engagement.invitee.display_name(nil,engagement).titleize %>
                    <% else %>
                      <li><%= image_tag "user_green.png" %> <%=  engagement.invitee.display_name(nil,engagement).titleize %>
                    <% end  %>
                    (Score <%= spectator.totalscore %>)
              <% end  %>

              <!-- common to both -->
              <%= link_to_function( (image_tag ("bullet_arrow_down.png")),  :id => "more_link_down_#{engagement.invitee.id}") do |page|
                      page.visual_effect  :toggle_blind, "user-details_#{engagement.invitee.id}"
                      page.show "more_link_up_#{engagement.invitee.id}"
                      page.hide "more_link_down_#{engagement.invitee.id}"
                      #page.replace_html 'more_link', "#{image_tag "bullet_arrow_up.png"}"
               end  %>

               <%= link_to_function( (image_tag ("bullet_arrow_up.png")),  :id => "more_link_up_#{engagement.invitee.id}", :style => 'display:none;') do |page|
                      page.visual_effect  :toggle_blind, "user-details_#{engagement.invitee.id}"
                      page.hide "more_link_up_#{engagement.invitee.id}"
                      page.show "more_link_down_#{engagement.invitee.id}"
               end  %>

               <div id="user-details_<%=engagement.invitee.id %>"  style="display:none;">
                    <% if engagement.invitee.avatar? %>
                      <%= image_tag engagement.invitee.avatar.url(:thumb) %>
                    <% else %>
                      No photo available <br/>
                    <% end %>

                     <div class ="user-bio">
                          <b>Twitter Profile:</b><br/>
                           <%= engagement.invitee.screen_name.blank? ? "" : "http://twitter.com/" + engagement.invitee.screen_name %><br/>
                          <b>Blog:</b><br/>
                          <%= link_to engagement.invitee.blog_link, engagement.invitee.blog_link if !engagement.invitee.blog_link.nil? %> <br/>
                          <b>Facebook Profile:</b><br/>
                          <%=h engagement.invitee.facebook_link %><br/>
                          <b>LinkedIn Profile:</b><br/>
                          <%=h engagement.invitee.linked_in_link %><br/>
                     </div>
                 </div>
              </li>
           </div>
            <%  viewed_count = viewed_count + 1 if engagement.last_viewed_at != nil %>
       <% end %>
    <%  end %>
    </ul>
   <% if @user.admin? %>
       <%= viewed_count %> participant(s) have viewed this post.
   <% end %>

   </div>
  </div>
</div>
